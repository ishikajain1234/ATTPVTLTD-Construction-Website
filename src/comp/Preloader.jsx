import {useEffect, useState} from "react";
import gsap from "gsap";
import Lottie from "react-lottie";
import animationData from "./Animation.json"; // Replace with your actual path
import "./Preloader.css";

const Preloader = ({onComplete}) => {
  const [isVisible, setIsVisible] = useState(true);
  const [isMobile, setIsMobile] = useState(false);

  useEffect(() => {
    // Check screen width on component mount and resize
    const handleResize = () => {
      setIsMobile(window.innerWidth <= 768); // 768px is the breakpoint for tablets/mobiles
    };

    handleResize(); // Initial check
    window.addEventListener("resize", handleResize); // Listen for resize events

    // Ensure the background color stays black until preloader is done
    document.body.style.backgroundColor = "black";

    gsap.to(".loading-page", {
      opacity: 0,
      duration: 2,
      delay: 2, // Wait for animation before fading out
      onComplete: () => {
        setIsVisible(false);
        onComplete(); // Callback to hide preloader
      },
    });

    // Cleanup resize listener
    return () => window.removeEventListener("resize", handleResize);
  }, [onComplete]);

  if (!isVisible) return null;

  const lottieOptions = {
    loop: true,
    autoplay: true,
    animationData: animationData, // Your JSON animation data
    rendererSettings: {
      preserveAspectRatio: "xMidYMid slice",
    },
  };

  return (
    <div className="loading-page">
      {isMobile ? (
        <div className="text-center">
          <Lottie options={lottieOptions} height={150} width={150} />
          <h1 className="text-[#DAA520] font-bold text-5xl">CIVIL-SITE</h1>
        </div>
      ) : (
        <svg id="svg" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M29.375 19.75C26.2083 19.9167 23.5417 21.125 21.375 23.375C19.2917 25.625 17.7917 28.2083 16.875 31.125C15.9583 33.9583 15.5 36.875 15.5 39.875C15.5 42.875 15.9167 45.8333 16.75 48.75C17.6667 51.6667 19.2083 54.25 21.375 56.5C23.5417 58.6667 26.2083 59.8333 29.375 60H70.625C75.875 60.5 78.75 63.375 79.25 68.625C79.1667 70.9583 78.2917 72.9167 76.625 74.5C74.9583 76 72.9583 76.75 70.625 76.75H30.75H25C19.1667 76.4167 14.375 74.2083 10.625 70.125C6.875 65.9583 4.16667 61.25 2.5 56C0.916667 50.75 0.125 45.375 0.125 39.875C0.125 35.7917 0.583333 31.75 1.5 27.75C2.41667 23.75 3.83333 19.9583 5.75 16.375C7.75 12.7083 10.375 9.58333 13.625 7C16.9583 4.41667 20.75 3.08333 25 3H27.375H70.625C75.875 3.5 78.75 6.375 79.25 11.625C79.25 13.9583 78.375 15.9167 76.625 17.5C74.9583 19 72.9583 19.75 70.625 19.75H29.375ZM88.125 68.375C88.125 66.0417 88.9167 64.0833 90.5 62.5C92.1667 60.8333 94.1667 60 96.5 60H120.5V19.75H96.5C94.1667 19.75 92.2083 18.9167 90.625 17.25C88.9583 15.6667 88.125 13.7083 88.125 11.375C88.125 9.04167 88.9167 7.08333 90.5 5.5C92.1667 3.83333 94.1667 3 96.5 3H161.25C163.583 3 165.583 3.79167 167.25 5.375C168.833 7.04167 169.625 9.04167 169.625 11.375C169.625 13.7083 168.792 15.7083 167.125 17.375C165.542 18.9583 163.583 19.75 161.25 19.75H137.375V60H161.25C163.583 60 165.583 60.7917 167.25 62.375C168.833 64.0417 169.625 66.0417 169.625 68.375C169.625 70.7083 168.792 72.7083 167.125 74.375C165.542 75.9583 163.583 76.75 161.25 76.75H96.5C94.1667 76.75 92.2083 75.9167 90.625 74.25C88.9583 72.6667 88.125 70.7083 88.125 68.375ZM206.375 70.125C202.542 64.375 198.708 56.8333 194.875 47.5L181.125 12C180.708 11.0833 180.458 10.0833 180.375 9C180.208 6.66667 180.875 4.66667 182.375 3C183.958 1.33333 185.958 0.5 188.375 0.5C190.958 0.5 192.875 1.08333 194.125 2.25C195.458 3.33333 196.542 4.75 197.375 6.5L209.25 39C210.583 42.4167 211.875 45.6667 213.125 48.75C214.458 51.75 215.917 54.5 217.5 57C219.083 59.5 220.875 60.8333 222.875 61C224.792 60.8333 226.5 59.5 228 57C229.667 54.5 231.125 51.75 232.375 48.75C233.708 45.6667 235.042 42.4167 236.375 39L248 6.5C248.833 4.75 249.875 3.33333 251.125 2.25C252.458 1.08333 254.5 0.5 257.25 0.5C259.667 0.5 261.625 1.33333 263.125 3C264.708 4.66667 265.417 6.66667 265.25 9C265.167 10.0833 264.917 11.0833 264.5 12L250.75 47.5C246.917 57 243.083 64.5833 239.25 70.25C235.5 75.8333 230.042 78.6667 222.875 78.75C215.625 78.6667 210.125 75.7917 206.375 70.125ZM275.5 68.375C275.5 66.0417 276.292 64.0833 277.875 62.5C279.542 60.8333 281.542 60 283.875 60H307.875V19.75H283.875C281.542 19.75 279.583 18.9167 278 17.25C276.333 15.6667 275.5 13.7083 275.5 11.375C275.5 9.04167 276.292 7.08333 277.875 5.5C279.542 3.83333 281.542 3 283.875 3H348.625C350.958 3 352.958 3.79167 354.625 5.375C356.208 7.04167 357 9.04167 357 11.375C357 13.7083 356.167 15.7083 354.5 17.375C352.917 18.9583 350.958 19.75 348.625 19.75H324.75V60H348.625C350.958 60 352.958 60.7917 354.625 62.375C356.208 64.0417 357 66.0417 357 68.375C357 70.7083 356.167 72.7083 354.5 74.375C352.917 75.9583 350.958 76.75 348.625 76.75H283.875C281.542 76.75 279.583 75.9167 278 74.25C276.333 72.6667 275.5 70.7083 275.5 68.375ZM378.25 1C380.583 1 382.583 1.79167 384.25 3.375C385.917 4.875 386.792 6.79167 386.875 9.125V39.25C386.792 42.6667 387 45.8333 387.5 48.75C388.083 51.5833 389.417 54.125 391.5 56.375C393.583 58.625 396.208 59.8333 399.375 60H439.375C441.708 60.0833 443.625 60.9583 445.125 62.625C446.708 64.2917 447.5 66.2917 447.5 68.625C447.417 70.875 446.583 72.7917 445 74.375C443.5 75.875 441.625 76.6667 439.375 76.75H395.125C389.292 76.4167 384.458 74.4583 380.625 70.875C376.875 67.2083 374.167 62.75 372.5 57.5C370.917 52.25 370.083 46.6667 370 40.75V9.125C370.083 6.875 370.917 5 372.5 3.5C374.083 1.91667 376 1.08333 378.25 1ZM464.5 47C462.667 47 461.083 46.375 459.75 45.125C458.417 43.7917 457.75 42.2083 457.75 40.375C457.75 38.4583 458.417 36.875 459.75 35.625C461.083 34.2917 462.667 33.625 464.5 33.625H486C487.833 33.625 489.417 34.2917 490.75 35.625C492.083 36.875 492.75 38.4583 492.75 40.375C492.75 42.2083 492.083 43.7917 490.75 45.125C489.417 46.375 487.833 47 486 47H464.5ZM587.5 11.375C587.5 13.7083 586.667 15.6667 585 17.25C583.417 18.9167 581.458 19.75 579.125 19.75H529.125C527.542 19.8333 526.208 20.2083 525.125 20.875C524.125 21.4583 523.375 22.1667 522.875 23C522.375 23.75 522.125 24.5417 522.125 25.375C522.125 26.2083 522.375 27.0417 522.875 27.875C523.375 28.625 524.125 29.3333 525.125 30C526.208 30.5833 527.542 30.9167 529.125 31H564.625C570.458 31.1667 575.25 32.5417 579 35.125C582.833 37.625 585.542 40.5417 587.125 43.875C588.792 47.125 589.625 50.4583 589.625 53.875C589.625 57.2083 588.792 60.5417 587.125 63.875C585.458 67.125 582.75 70.0417 579 72.625C575.25 75.125 570.458 76.375 564.625 76.375H563.875C563.375 76.4583 562.875 76.5 562.375 76.5H515.125C512.792 76.5 510.792 75.7083 509.125 74.125C507.542 72.4583 506.75 70.4583 506.75 68.125C506.75 65.7917 507.583 63.8333 509.25 62.25C510.833 60.5833 512.792 59.75 515.125 59.75H565.375C566.958 59.8333 568.25 59.5417 569.25 58.875C570.333 58.2083 571.125 57.4583 571.625 56.625C572.125 55.7083 572.375 54.7917 572.375 53.875C572.375 53.2917 572.125 52.5 571.625 51.5C571.125 50.4167 570.333 49.5417 569.25 48.875C568.25 48.2083 566.958 47.8333 565.375 47.75H529.875C524.042 47.5833 519.208 46.25 515.375 43.75C511.625 41.25 508.917 38.4167 507.25 35.25C505.667 32 504.875 28.7083 504.875 25.375C504.875 22.125 505.708 18.9167 507.375 15.75C509.042 12.5 511.75 9.625 515.5 7.125C519.25 4.625 524.042 3.29167 529.875 3.125H530.625C531.125 3.04167 531.625 3 532.125 3H579.125C581.458 3 583.417 3.83333 585 5.5C586.667 7.08333 587.5 9.04167 587.5 11.375ZM601 68.375C601 66.0417 601.792 64.0833 603.375 62.5C605.042 60.8333 607.042 60 609.375 60H633.375V19.75H609.375C607.042 19.75 605.083 18.9167 603.5 17.25C601.833 15.6667 601 13.7083 601 11.375C601 9.04167 601.792 7.08333 603.375 5.5C605.042 3.83333 607.042 3 609.375 3H674.125C676.458 3 678.458 3.79167 680.125 5.375C681.708 7.04167 682.5 9.04167 682.5 11.375C682.5 13.7083 681.667 15.7083 680 17.375C678.417 18.9583 676.458 19.75 674.125 19.75H650.25V60H674.125C676.458 60 678.458 60.7917 680.125 62.375C681.708 64.0417 682.5 66.0417 682.5 68.375C682.5 70.7083 681.667 72.7083 680 74.375C678.417 75.9583 676.458 76.75 674.125 76.75H609.375C607.042 76.75 605.083 75.9167 603.5 74.25C601.833 72.6667 601 70.7083 601 68.375ZM693 11.375C693 9.04167 693.792 7.08333 695.375 5.5C697.042 3.83333 699.042 3 701.375 3H774.125C776.458 3 778.458 3.79167 780.125 5.375C781.708 7.04167 782.5 9.04167 782.5 11.375C782.5 13.7083 781.667 15.7083 780 17.375C778.417 18.9583 776.458 19.75 774.125 19.75H746.25V70.375C745.75 75.375 743 78.0833 738 78.5C735.667 78.5 733.625 77.75 731.875 76.25C730.208 74.6667 729.375 72.7083 729.375 70.375V19.75H701.375C699.042 19.75 697.083 18.9167 695.5 17.25C693.833 15.6667 693 13.7083 693 11.375ZM818.875 3H824.625H867.125C869.458 3.08333 871.375 3.95833 872.875 5.625C874.458 7.29167 875.25 9.29167 875.25 11.625C874.833 16.625 872.125 19.3333 867.125 19.75H823.125C819.958 19.9167 817.333 21.125 815.25 23.375C813.167 25.625 811.625 28.2083 810.625 31.125C809.708 33.9583 809.25 36.875 809.25 39.875C809.25 42.875 809.708 45.8333 810.625 48.75C811.625 51.5833 813.167 54.125 815.25 56.375C817.333 58.625 819.958 59.8333 823.125 60H867.125C869.458 60.0833 871.375 60.9583 872.875 62.625C874.458 64.2917 875.25 66.2917 875.25 68.625C875.167 70.875 874.333 72.7917 872.75 74.375C871.25 75.875 869.375 76.6667 867.125 76.75H821.25H818.875C813.042 76.4167 808.208 74.2083 804.375 70.125C800.625 65.9583 797.917 61.25 796.25 56C794.667 50.75 793.875 45.375 793.875 39.875C793.875 34.375 794.708 29 796.375 23.75C798.042 18.5 800.75 13.8333 804.5 9.75C808.25 5.58333 813.042 3.33333 818.875 3ZM875 39.375C875 41.7083 874.167 43.6667 872.5 45.25C870.917 46.9167 868.958 47.75 866.625 47.75H828.875C826.542 47.75 824.542 46.9583 822.875 45.375C821.292 43.7083 820.5 41.7083 820.5 39.375C820.5 37.0417 821.292 35.0417 822.875 33.375C824.542 31.7917 826.542 31 828.875 31H866.625C868.958 31 870.917 31.8333 872.5 33.5C874.167 35.0833 875 37.0417 875 39.375Z"
            fill="white"
          />
        </svg>
      )}
    </div>
  );
};

export default Preloader;
